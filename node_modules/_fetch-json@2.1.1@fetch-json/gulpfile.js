// fetch-json
// Tasks

// Imports
const babel =       require('gulp-babel');
const gulp =        require('gulp');
const header =      require('gulp-header');
const mergeStream = require('merge-stream');
const replace =     require('gulp-replace');
const rename =      require('gulp-rename');
const size =        require('gulp-size');

// Setup
const pkg = require('./package.json');
const banner = [
   `//! fetch-json v${pkg.version}\n`,
   `//! ${pkg.description}\n`,
   `//! ${pkg.homepage} -- ${pkg.license} License\n`
   ];
const transpileES6 =   ['@babel/env', { modules: false }];

// Tasks
const task = {
   build: function() {
      function updateBanner() {
         return gulp.src('fetch-json.js')
            .pipe(replace(/\/\/!.*\n/g, ''))
            .pipe(header(banner.join('')))
            .pipe(replace(/'\d[.]\d[.]\d'/, `'${pkg.version}'`))
            .pipe(size({ showFiles: true }))
            .pipe(gulp.dest('.'));
         }
      function minify() {
         return gulp.src('fetch-json.js')
            .pipe(rename({ extname: '.min.js' }))
            .pipe(babel({ presets: [transpileES6, 'minify'] }))
            .pipe(header(banner[0] + banner[2]))
            .pipe(replace(/'\d[.]\d[.]\d'/, `'${pkg.version}'`))
            .pipe(size({ showFiles: true }))
            .pipe(gulp.dest('.'));
         }
      return mergeStream(updateBanner(), minify());
      }
   };

// Gulp
gulp.task('build', task.build);


////////////////////////////////////////////////////////////////////////////////////////////////////
// Documentation sample
task.docSample = function() {
const fetchJson = require('fetch-json');
/*
Quick #javascript snippet to show how easy it is to #fetchJson data from NASA's API to get the Astronomy Picture of the Day (APoD).  #json #fetchapi
‚≠ê https://github.com/center-key/fetch-json
*/

// NASA APoD
const url =    'https://api.nasa.gov/planetary/apod';
const params = { api_key: 'DEMO_KEY' };
function handleData(data) {
   console.log('The NASA APoD for today is at: ' + data.url);
   }
fetchJson.get(url, params).then(handleData);

};
